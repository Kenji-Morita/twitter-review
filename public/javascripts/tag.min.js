riot.tag("swt-common","",function(t){var n=this,e=window.superagent;this.isLogin=t.isLogin,this.obs=riot.observable(),this.doSignUp=function(t,n,i){t.isEmpty||n.isEmpty||i.isEmpty||e.post("api/auth/signup").send({mail:t,password:n,passwordConfirm:i}).set("Accept","application/json").end(function(t,n){n.ok&&location.reload()})},this.doSignIn=function(t,n){t.isEmpty||n.isEmpty||e.post("api/auth/signin").withCredentials().send({mail:t,password:n}).set("Accept","application/json").end(function(t,n){n.ok&&location.reload()})},this.doSignOut=function(){e.post("/api/auth/signout").withCredentials().end(function(t,n){n.ok&&(location.href="/")})},this.findTimeline=function(t,i){var o="/api/timeline/home",s=!1,a=function(t,n){s?o+="&":(o+="?",s=!0),o+=t+"="+n};null!=t&&a("before",t),null!=i&&a("after",i),e.get(o).withCredentials().end(function(t,e){if(e.ok){var i=JSON.parse(e.text).value;n.obs.trigger("onLoadTimeline",i)}})},this.putGood=function(t){e.put("/api/value/good/"+t).end(function(e,i){if(i.ok){var o=JSON.parse(i.text).value;n.obs.trigger("onValueUpdated",{tweetId:t,value:o})}})},this.putBad=function(t){e.put("/api/value/bad/"+t).end(function(e,i){if(i.ok){var o=JSON.parse(i.text).value;n.obs.trigger("onValueUpdated",{tweetId:t,value:o})}})}}),riot.tag("swt-contents",'<div class="sg-contents {sg-contents-separate: isDetail}"><swt-tweet if="{!isDetail && opts.isLogin}"></swt-tweet><swt-timeline if="{!isDetail}" opts="{opts}"></swt-timeline><swt-detail if="{isDetail}" opts="{opts}"></swt-detail><swt-iframe if="{isDetail}"></swt-iframe><swt-modal if="{isShowModal}" opts="{opts}"></swt-modal></div>',function(t){var n=this;this.isDetail=!1,this.isShowModal=!1,t.obs.on("showDetail",function(){n.isDetail=!0,n.update()}),t.obs.on("hideDetail",function(){n.isDetail=!1,n.update()}),t.obs.on("showModal",function(){n.isShowModal=!0,n.update()}),t.obs.on("hideModal",function(){setTimeout(function(){n.isShowModal=!1,n.update()},300)})}),riot.tag("swt-detail",'<div class="sg-contents-detail"></div>',function(t){}),riot.tag("swt-footer",'<footer class="sg-footer"><div class="sg-container"><p>(c)2015 SAW</p></div></footer>',function(t){}),riot.tag("swt-header",'<header class="sg-header"><ul><li class="sg-header-logo"><h1>Sawitter</h1></li><li if="{isLogin}" class="sg-header-tweet"><a href="#" onclick="{tweetNews}"><i class="fa fa-pencil-square-o"></i></a></li><li class="sg-header-signs"><ul><li if="{!isLogin}" onclick="{onSignin}" class="sg-header-signin"><button>サインイン</button></li><li if="{!isLogin}" onclick="{onSignup}" class="sg-header-signup"><button>登録</button></li><li if="{isLogin}" onclick="{onSignout}" class="sg-header-signout"><button>サインアウト</button></li></ul></li></ul></header><form name="signin" class="sg-header-signs-signin" if="{false}"><label>メールアドレス</label><input type="text" name="signinMail" placeholder="メールアドレスを入力してください"><label>パスワード</label><input type="password" name="signinPassword" placeholder="パスワードを入力してください"></form><form name="signup" class="sg-header-signs-signup" if="{false}"><label>メールアドレス</label><input type="text" name="signupMail" placeholder="メールアドレスを入力してください"><label>パスワード</label><input type="password" name="signupPassword" placeholder="パスワードを入力してください"><label>パスワード(再確認)</label><input type="password" name="signupPasswordConfirm" placeholder="パスワードを再度入力してください"></form>',function(t){var n=this;this.isLogin=t.isLogin,this.tweetNews=function(t){t.preventDefault();var n=10,e=60,i=window.scrollY/e,o=function(){var t=window.scrollY,s=t-i,s=0>=s?0:s;t>0&&(window.scrollTo(0,s),s>0&&setTimeout(o,n/e))};o()},this.onSignin=function(e){e.preventDefault(),t.obs.trigger("showModal",{title:"サインイン",raw:n.signin.innerHTML,okButtonMsg:"サインイン",ngButtonMsg:"キャンセル",ok:function(n){var e=n.querySelector('input[name="signinMail"]').value.trim(),i=n.querySelector('input[name="signinPassword"]').value.trim();return""==e?void alert("メールアドレスが入力されていません"):""==i?void alert("パスワードが入力されていません"):void t.doSignIn(e,i)},ng:function(n){t.obs.trigger("hideModal")}})},this.onSignup=function(e){e.preventDefault(),t.obs.trigger("showModal",{title:"登録",raw:n.signup.innerHTML,okButtonMsg:"登録",ngButtonMsg:"キャンセル",ok:function(n){var e=n.querySelector('input[name="signupMail"]').value.trim(),i=n.querySelector('input[name="signupPassword"]').value.trim(),o=n.querySelector('input[name="signupPasswordConfirm"]').value.trim();return""==e?void alert("メールアドレスが入力されていません"):""==i?void alert("パスワードが入力されていません"):""==o?void alert("パスワード(再確認)が入力されていません"):void t.doSignUp(e,i,o)},ng:function(n){t.obs.trigger("hideModal")}})},this.onSignout=function(n){n.preventDefault(),t.doSignOut()}}),riot.tag("swt-iframe",'<iframe class="sg-contents-iframe"></iframe>',function(t){}),riot.tag("swt-modal",'<div class="sg-contents-modal"><div class="{sg-contents-modal-bg: isShowModal}" onclick="{closeModal}"></div><div if="{isShowModal}" class="sg-contents-modal-contents"><section><header class="sg-contents-modal-contents-header"><h1>{contents.title}</h1></header><div name="raw" class="sg-contents-modal-contents-msg"></div><footer class="sg-contents-modal-contents-footer"><ul><li><button onclick="{onOk}">{contents.okButtonMsg}</button></li><li><button onclick="{onNg}">{contents.ngButtonMsg}</button></li></ul></footer></section></div></div>',function(t){var n=this,t=t.opts;this.isShowModal=!1,this.contents={},this.closeModal=function(n){n.preventDefault(),t.obs.trigger("hideModal")},this.onOk=function(t){t.preventDefault(),n.contents.ok(n.raw)},this.onNg=function(t){t.preventDefault(),n.contents.ng(n.raw)},t.obs.on("showModal",function(t){n.contents=t,n.raw.innerHTML=t.raw,setTimeout(function(){n.isShowModal=!0,n.update()},1)}),t.obs.on("hideModal",function(){n.contents={},n.raw.innerHTML="",n.isShowModal=!1,n.update()})}),riot.tag("swt-raw","<div></div>",function(t){this.root.innerHTML=t.content,this.update()}),riot.tag("swt-timeline",'<ul class="sg-contents-timeline {sg-contents-timeline-detail: isDetail}"><li each="{tweets}"><section><dl class="sg-contents-timeline-share"><dt><a href="/content/{shareContents.shareContentsId}" data-id="{shareContents.shareContentsId}" onclick="{onClickDetail}"><img riot-src="{shareContents.thumbnailUrl}" alt="{shareContents.title}"></a></dt><dd><h1><a href="/content/{shareContents.shareContentsId}" data-id="{shareContents.shareContentsId}" onclick="{onClickDetail}"> {shareContents.title} </a></h1></dd></dl><dl class="sg-contents-timeline-comment"><dt><i class="fa fa-user fa-2x"></i></dt><dd><p>{tweet.comment}</p><time>{tweet.postedAt}</time></dd></dl><ul class="sg-contents-timeline-btn"><li><a class="sg-contents-timeline-btn-good" onclick="{onPutGood}" __disabled="{!opts.isLogin}" href="#"><i class="fa fa-thumbs-up"></i> {value.good} <span data-id="{tweet.tweetId}"><i class="fa fa-thumbs-up"></i> Good </span></a></li><li><a class="sg-contents-timeline-btn-bad" onclick="{onPutBad}" __disabled="{!opts.isLogin}" href="#"><i class="fa fa-thumbs-down"></i> {value.bad} <span data-id="{tweet.tweetId}"><i class="fa fa-thumbs-down"></i> Bad </span></a></li></ul></section></li></ul>',function(t){var n=this,t=t.opts;this.isDetail=!1,this.tweets=[];window.superagent;this.onClickDetail=function(t){t.preventDefault()},this.onPutGood=function(n){n.preventDefault(),t.putGood(n.target.getAttribute("data-id"))},this.onPutBad=function(n){n.preventDefault(),t.putBad(n.target.getAttribute("data-id"))},t.obs.on("onLoadTimeline",function(t){n.tweets=t,n.update()}),t.obs.on("showDetail",function(){n.isDetail=!0,n.update()}),t.obs.on("hideDetail",function(){n.isDetail=!1,n.update()}),t.obs.on("onValueUpdated",function(t){n.update()});var e=function(){n.tweets.length>0?t.findTimeline(null,n.tweets[0].timestamp):t.findTimeline()},i=function(){e(),setTimeout(i,1e4)};i()}),riot.tag("swt-tweet",'<div class="sg-contents-tweet"><form onsubmit="{onSubmit}"><input type="text" name="tweet-url" oninput="{onInputUrl}" placeholder="気になったWEBページのアドレスを入力"><textarea name="tweet-comment" if="{isStartDisplayComment}" oninput="{onInputComment}" class="{sg-contents-tweet-comment-show: isDisplayComment}" placeholder="コメントを入力"></textarea><div class="sg-contents-tweet-submit"><span class="{sg-contents-tweet-submit-invalid: commentLength > 140}">{commentLength}</span><button>投稿</button></div></form></div>',function(t){var n=this;this.isStartDisplayComment=!1,this.isDisplayComment=!1,this.commentLength=0,this.onInputUrl=function(t){var e=t.target.value;e.length>0?(n.isStartDisplayComment=!0,n.update(),setTimeout(function(){n.isDisplayComment=!0,n.update()},1)):(n.isDisplayComment=!1,n.update(),setTimeout(function(){n.isStartDisplayComment=!1,n.update()},200))},this.onInputComment=function(t){n.commentLength=t.target.value.length,n.update()},this.onSubmit=function(t){t.preventDefault()}});