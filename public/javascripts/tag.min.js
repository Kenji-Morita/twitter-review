riot.tag("swt-common","",function(t){var e=this,n=window.superagent;this.isLogin=t.isLogin,this.obs=riot.observable(),this.currentKeyCodes=[],this.doSignUp=function(t,e,i){t.isEmpty||e.isEmpty||i.isEmpty||n.post("api/auth/signup").send({mail:t,password:e,passwordConfirm:i}).set("Accept","application/json").end(function(t,e){e.ok&&location.reload()})},this.doSignIn=function(t,e){t.isEmpty||e.isEmpty||n.post("api/auth/signin").withCredentials().send({mail:t,password:e}).set("Accept","application/json").end(function(t,e){e.ok&&location.reload()})},this.doSignOut=function(){n.post("/api/auth/signout").withCredentials().end(function(t,e){e.ok&&(location.href="/")})},this.findTimeline=function(t,i){var s="/api/timeline/home",o=!1,a=function(t,e){o?s+="&":(s+="?",o=!0),s+=t+"="+e};null!=t&&a("before",t),null!=i&&a("after",i),n.get(s).withCredentials().end(function(t,n){if(n.ok){var i=JSON.parse(n.text).value;e.obs.trigger("onLoadTimeline",i)}})},this.doPost=function(t,i){n.post("/api/tweet/tweet").send({url:t,comment:i}).set("Accept","application/json").end(function(t,n){n.ok&&e.obs.trigger("onPosted")})},this.putGood=function(t){n.put("/api/value/good/"+t).end(function(n,i){if(i.ok){var s=JSON.parse(i.text).value;e.obs.trigger("onValueUpdated",{tweetId:t,value:s})}})},this.putBad=function(t){n.put("/api/value/bad/"+t).end(function(n,i){if(i.ok){var s=JSON.parse(i.text).value;e.obs.trigger("onValueUpdated",{tweetId:t,value:s})}})},this.findContentsDetail=function(t){n.get("/api/contents/"+t).end(function(t,n){if(n.ok){var i=JSON.parse(n.text).value;e.obs.trigger("onContentsLoaded",i)}})},window.addEventListener("keydown",function(t){var n=t.keyCode,i=e.currentKeyCodes.indexOf(n);0>i&&e.currentKeyCodes.push(n)}),window.addEventListener("keyup",function(t){var n=e.currentKeyCodes.indexOf(t.keyCode);n>=0&&e.currentKeyCodes.splice(n,1)}),window.addEventListener("popstate",function(t){var n=t.target.location.pathname;"/"==n&&e.obs.trigger("hideDetail")})}),riot.tag("swt-contents",'<div class="sg-contents {sg-contents-separate: isDetail}"><swt-cover if="{!isDetail && !opts.isLogin}"></swt-cover><swt-tweet if="{!isDetail && opts.isLogin}"></swt-tweet><swt-timeline if="{!isDetail}" opts="{opts}"></swt-timeline><swt-detail if="{isDetail}" opts="{opts}"></swt-detail><swt-iframe if="{isDetail}" opts="{opts}"></swt-iframe><swt-modal if="{isShowModal}" opts="{opts}"></swt-modal></div>',function(t){var e=this;this.isDetail=!1,this.isShowModal=!1,t.obs.on("showDetail",function(){e.isDetail=!0,e.update()}),t.obs.on("hideDetail",function(){e.isDetail=!1,e.update()}),t.obs.on("showModal",function(){e.isShowModal=!0,e.update()}),t.obs.on("hideModal",function(){setTimeout(function(){e.isShowModal=!1,e.update()},300)})}),riot.tag("swt-cover",'<div class="sg-contents-cover"><ul></ul></div>',function(t){}),riot.tag("swt-detail",'<div class="sg-contents-detail"><section><header><h1><a href="{contents.shareContents.url}" target="_blank">{contents.shareContents.title}</a></h1><p>{contents.shareContents.url}</p></header><ul class="sg-contents-detail-timeline"><li each="{contents.tweets}"><section><dl class="sg-contents-timeline-comment"><dt><i class="fa fa-user fa-2x"></i></dt><dd><p>{tweet.comment}</p><time>{tweet.postedAt}</time></dd></dl><ul class="sg-contents-timeline-btn"><li><a class="sg-contents-timeline-btn-good" onclick="{onPutGood}" __disabled="{!opts.isLogin}" href="#"><i class="fa fa-thumbs-up"></i> {value.good} <span data-id="{tweet.tweetId}"><i class="fa fa-thumbs-up"></i> Good </span></a></li><li><a class="sg-contents-timeline-btn-bad" onclick="{onPutBad}" __disabled="{!opts.isLogin}" href="#"><i class="fa fa-thumbs-down"></i> {value.bad} <span data-id="{tweet.tweetId}"><i class="fa fa-thumbs-down"></i> Bad </span></a></li></ul></section></li></ul></section></div>',function(t){var e=this,t=t.opts;this.contents={},t.obs.on("onContentsLoaded",function(t){e.contents=t,e.update()})}),riot.tag("swt-footer",'<footer class="sg-footer"><div class="sg-container"><p>(c)2015 SAW</p></div></footer>',function(t){}),riot.tag("swt-header",'<header class="sg-header"><ul><li class="sg-header-logo"><h1><a href="/">Sawitter</a></h1></li><li if="{isLogin}" class="sg-header-tweet"><a href="#" onclick="{tweetNews}"><i class="fa fa-pencil-square-o"></i></a></li><li class="sg-header-signs"><ul><li if="{!isLogin}" onclick="{onSignin}" class="sg-header-signin"><button>サインイン</button></li><li if="{!isLogin}" onclick="{onSignup}" class="sg-header-signup"><button>登録</button></li><li if="{isLogin}" onclick="{onSignout}" class="sg-header-signout"><button>サインアウト</button></li></ul></li></ul></header><form name="signin" class="sg-header-signs-signin" if="{false}"><label>メールアドレス</label><input type="text" name="signinMail" placeholder="メールアドレスを入力してください"><label>パスワード</label><input type="password" name="signinPassword" placeholder="パスワードを入力してください"></form><form name="signup" class="sg-header-signs-signup" if="{false}"><label>メールアドレス</label><input type="text" name="signupMail" placeholder="メールアドレスを入力してください"><label>パスワード</label><input type="password" name="signupPassword" placeholder="パスワードを入力してください"><label>パスワード(再確認)</label><input type="password" name="signupPasswordConfirm" placeholder="パスワードを再度入力してください"></form>',function(t){var e=this;this.isLogin=t.isLogin,this.tweetNews=function(t){t.preventDefault();var e=10,n=60,i=window.scrollY/n,s=function(){var t=window.scrollY,o=t-i,o=0>=o?0:o;t>0&&(window.scrollTo(0,o),o>0&&setTimeout(s,e/n))};s()},this.onSignin=function(n){n.preventDefault(),t.obs.trigger("showModal",{title:"サインイン",raw:e.signin.innerHTML,okButtonMsg:"サインイン",ngButtonMsg:"キャンセル",ok:function(e){var n=e.querySelector('input[name="signinMail"]').value.trim(),i=e.querySelector('input[name="signinPassword"]').value.trim();return""==n?void alert("メールアドレスが入力されていません"):""==i?void alert("パスワードが入力されていません"):void t.doSignIn(n,i)},ng:function(e){t.obs.trigger("hideModal")}})},this.onSignup=function(n){n.preventDefault(),t.obs.trigger("showModal",{title:"登録",raw:e.signup.innerHTML,okButtonMsg:"登録",ngButtonMsg:"キャンセル",ok:function(e){var n=e.querySelector('input[name="signupMail"]').value.trim(),i=e.querySelector('input[name="signupPassword"]').value.trim(),s=e.querySelector('input[name="signupPasswordConfirm"]').value.trim();return""==n?void alert("メールアドレスが入力されていません"):""==i?void alert("パスワードが入力されていません"):""==s?void alert("パスワード(再確認)が入力されていません"):void t.doSignUp(n,i,s)},ng:function(e){t.obs.trigger("hideModal")}})},this.onSignout=function(e){e.preventDefault(),t.doSignOut()}}),riot.tag("swt-iframe",'<iframe class="sg-contents-iframe" name="contentsIframe"></iframe>',function(t){var e=this,t=t.opts;t.obs.on("onContentsLoaded",function(t){e.contentsIframe.src=t.shareContents.url})}),riot.tag("swt-modal",'<div class="sg-contents-modal"><div class="{sg-contents-modal-bg: isShowModal}" onclick="{closeModal}"></div><div if="{isShowModal}" class="sg-contents-modal-contents"><section><header class="sg-contents-modal-contents-header"><h1>{contents.title}</h1></header><div if="{contents.raw != null}" name="raw" class="sg-contents-modal-contents-raw"></div><div if="{contents.msg != null}">{contents.msg}</div><div if="{contents.msgSub != null}" class="sg-contents-modal-contents-msg-sub">{contents.msgSub}</div><footer class="sg-contents-modal-contents-footer"><ul><li><button onclick="{onOk}">{contents.okButtonMsg}</button></li><li><button onclick="{onNg}">{contents.ngButtonMsg}</button></li></ul></footer></section></div></div>',function(t){var e=this,t=t.opts;this.isShowModal=!1,this.contents={},this.closeModal=function(e){e.preventDefault(),t.obs.trigger("hideModal")},this.onOk=function(t){t.preventDefault(),e.contents.ok(e.raw)},this.onNg=function(t){t.preventDefault(),e.contents.ng(e.raw)},t.obs.on("showModal",function(t){e.contents=t,e.raw.innerHTML=t.raw,setTimeout(function(){e.isShowModal=!0,e.update()},1)}),t.obs.on("hideModal",function(){e.contents={},e.raw.innerHTML="",e.isShowModal=!1,e.update()})}),riot.tag("swt-timeline",'<ul class="sg-contents-timeline {sg-contents-timeline-detail: isDetail}"><li each="{tweets}"><section><dl class="sg-contents-timeline-share"><dt><a href="/content/{shareContents.shareContentsId}" onclick="{onClickDetail}"><img riot-src="{shareContents.thumbnailUrl}" alt="{shareContents.title}"></a></dt><dd><h1><a href="/content/{shareContents.shareContentsId}" onclick="{onClickDetail}"> {shareContents.title} </a></h1></dd></dl><dl class="sg-contents-timeline-comment"><dt><i class="fa fa-user fa-2x"></i></dt><dd><p>{tweet.comment}</p><time>{tweet.postedAt}</time></dd></dl><ul class="sg-contents-timeline-btn"><li><a class="sg-contents-timeline-btn-good" onclick="{onPutGood}" __disabled="{!opts.isLogin}" href="#"><i class="fa fa-thumbs-up"></i> {value.good} <span data-id="{tweet.tweetId}"><i class="fa fa-thumbs-up"></i> Good </span></a></li><li><a class="sg-contents-timeline-btn-bad" onclick="{onPutBad}" __disabled="{!opts.isLogin}" href="#"><i class="fa fa-thumbs-down"></i> {value.bad} <span data-id="{tweet.tweetId}"><i class="fa fa-thumbs-down"></i> Bad </span></a></li></ul></section></li></ul>',function(t){var e=this,t=t.opts;this.isDetail=!1,this.tweets=[],this.onClickDetail=function(e){e.preventDefault();var n=t.currentKeyCodes.indexOf(91),i=t.currentKeyCodes.indexOf(93);(n>=0||i>=0)&&window.open(e.item.shareContents.url);var s=e.item.shareContents.shareContentsId;t.obs.trigger("showDetail",s),t.findContentsDetail(s),history.pushState(e.item.shareContents.title,null,"/contents/"+s)},this.onPutGood=function(e){e.preventDefault(),t.putGood(e.target.getAttribute("data-id"))},this.onPutBad=function(e){e.preventDefault(),t.putBad(e.target.getAttribute("data-id"))},t.obs.on("onLoadTimeline",function(t){e.tweets=t,e.update()}),t.obs.on("showDetail",function(){e.isDetail=!0,e.update()}),t.obs.on("hideDetail",function(){e.isDetail=!1,e.update()}),t.obs.on("onValueUpdated",function(t){e.update()}),t.obs.on("onPosted",function(){setTimeout(n,100)});var n=function(){e.tweets.length>0?t.findTimeline(null,e.tweets[0].timestamp):t.findTimeline()},i=function(){n(),setTimeout(i,1e4)};i()}),riot.tag("swt-tweet",'<div class="sg-contents-tweet"><form onsubmit="{onSubmit}"><input type="text" name="tweetUrl" oninput="{onInputUrl}" placeholder="気になったWEBページのアドレスを入力"><textarea name="tweetComment" if="{isStartDisplayComment}" oninput="{onInputComment}" class="{sg-contents-tweet-comment-show: isDisplayComment}" placeholder="コメントを入力"></textarea><div class="sg-contents-tweet-submit"><span class="{sg-contents-tweet-submit-invalid: commentLength > 140}">{commentLength}</span><button __disabled="{!isDisplayComment || commentLength <= 0 || commentLength > 140}">投稿</button></div></form></div>',function(t){var e=this;this.isStartDisplayComment=!1,this.isDisplayComment=!1,this.commentLength=0,this.onInputUrl=function(t){var n=t.target.value;n.length>0?(e.isStartDisplayComment=!0,e.update(),setTimeout(function(){e.isDisplayComment=!0,e.update()},1)):(e.isDisplayComment=!1,e.update(),setTimeout(function(){e.isStartDisplayComment=!1,e.update()},200))},this.onInputComment=function(t){e.commentLength=t.target.value.length,e.update()},this.onSubmit=function(n){n.preventDefault();var i=e.tweetUrl,s=e.tweetComment,o=i.value.trim(),a=s.value.trim();return""==o?void alert("URLを入力してください"):""==a?void alert("コメントを入力してください"):void t.obs.trigger("showModal",{title:"投稿確認",msg:a,msgSub:"WEBページ("+o+")について、このコメントを投稿してもよろしいでしょうか？",okButtonMsg:"投稿",ngButtonMsg:"キャンセル",ok:function(){t.doPost(o,a),i.value="",s.value="",e.commentLength=0,t.obs.trigger("hideModal")},ng:function(){t.obs.trigger("hideModal")}})}});