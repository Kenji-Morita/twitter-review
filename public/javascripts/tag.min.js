riot.tag("commonfooter",'<footer class="sg-footer"><div class="sg-container"><p>(c)2015 SAW</p></div></footer>',function(e){}),riot.tag("commonheader",'<header class="sg-header"><div class="sg-container"><ul class="sg-header-contents"><li><h1>SAW Twitter</h1></li><li if="{opts.loginInfo.isLogin}"><a href="#">Setting</a><ul><li><a href="#">Setting</a></li><li><a href="#" onclick="{doSignOut}">Sign out</a></li></ul></li></ul></div></header>',function(e){var t=window.superagent;this.doSignOut=function(e){e.preventDefault(),t.post("/api/auth/signout").withCredentials().end(function(e,t){t.ok&&(location.href="/")})}}),riot.tag("follow",'<div if="{opts.loginInfo.isLogin && !isMe}"><button if="{!isFollowing}" onclick="{doFollow}">Follow</button><button if="{isFollowing}" onclick="{doUnFollow}">Unfollow</button></div>',function(e){var t=this,i=window.superagent;this.isFollowing=!1,this.isMe=!0,void 0!=e.loginInfo&&e.loginInfo.isLogin&&(e.loginInfo.member.following.list.indexOf(e.memberId)>=0&&(this.isFollowing=!0),this.isMe=e.loginInfo.member.memberId==e.memberId),this.doFollow=function(s){s.preventDefault(),i.post("/api/member/follow/"+e.memberId).withCredentials().end(function(e,i){i.ok&&(t.isFollowing=!0,t.update())})},this.doUnFollow=function(s){s.preventDefault(),i.del("/api/member/unfollow/"+e.memberId).withCredentials().end(function(e,i){i.ok?(t.isFollowing=!1,t.update()):console.log(i.text)})}}),riot.tag("post",'<form onsubmit="{doPostTweet}" class="sg-post-tweet"><p>tweet length: {tweetLength}</p><textarea oninput="{doInputTweet}"></textarea><button __disabled="{textLengthInvalid}">Tweet</button></form>',function(e){var t=this,i=window.superagent;this.tweetLength=0,this.textLengthInvalid=!0,this.doInputTweet=function(e){var i=e.target;s(i.value),t.update()},this.doPostTweet=function(e){e.preventDefault();var t=e.target.querySelectorAll("textarea")[0];i.post("/api/tweet/tweet").withCredentials().send({text:t.value}).set("Accept","application/json").end(function(e,i){i.ok&&(t.value="",s(t.value))})};var s=function(e){t.tweetLength=e.length,t.textLengthInvalid=t.tweetLength>140||t.tweetLength<=0?!0:!1,t.update()}}),riot.tag("profileaside","",function(e){}),riot.tag("profileaside",'<aside class="pg-profile"><img src="/assets/icon/1"><h2>{opts.member.displayName}</h2><p>{opts.member.profile.biography}</p><dl><dt>Followings</dt><dd><a href="/following/{opts.member.memberId}">{opts.member.following.count}</a></dd><dt>Followers</dt><dd><a href="/followers/{opts.member.memberId}">{opts.member.followers.count}</a></dd></dl></aside>',function(e){}),riot.tag("signforms",'<ul><li if="{!toggleState}"><a href="#" onclick="{toggle}">Sign in</a></li><li if="{toggleState}"><a href="#" onclick="{toggle}">Sign up</a></li></ul><form class="pg-sign-in" if="{toggleState}" onsubmit="{doSignIn}"><label if="{signIn.account.isEmpty}">Please input Mail Address or Name!</label><input type="text" name="account" placeholder="Mail address or Name"><label if="{signIn.password.isEmpty}">Please input Password!</label><input type="password" name="signInPassword" placeholder="Password"><button>Sign in</button></form><form class="pg-sign-up" if="{!toggleState}" onsubmit="{doSignUp}"><label if="{signUp.screenName.isEmpty}">Please input Account Name!</label><input type="text" name="screenName" placeholder="Account Name"><label if="{signUp.displayName.isEmpty}">Please input Display Name!</label><input type="text" name="displayName" placeholder="Display Name"><label if="{signUp.mail.isEmpty}">Please input Mail Address!</label><input type="mail" name="mail" placeholder="Mail address"><label if="{signUp.password.isEmpty}">Please input Password!</label><input type="password" name="signUpPassword" placeholder="Password"><label if="{signUp.passwordConfirm.isEmpty}">Please input Password again!</label><input type="password" name="signUpPasswordConfirm" placeholder="Password confirm"><button>Sign up</button></form>',function(e){var t=this,i=window.superagent;this.toggleState=!0,this.signIn={account:{isEmpty:!1},password:{isEmpty:!1}},this.signUp={screenName:{isEmpty:!1},displayName:{isEmpty:!1},mail:{isEmpty:!1},password:{isEmpty:!1},passwordConfirm:{isEmpty:!1}},this.toggle=function(e){e.preventDefault(),t.toggleState=!t.toggleState},this.doSignIn=function(e){e.preventDefault();var s=t.account.value.trim(),n=t.signInPassword.value.trim();t.signIn.account.isEmpty=""==s,t.signIn.password.isEmpty=""==n,t.signIn.account.isEmpty||t.signIn.password.isEmpty||i.post("api/auth/signin").withCredentials().send({screenName:s,mail:s,password:n}).set("Accept","application/json").end(function(e,t){if(t.ok)location.reload();else{var i=JSON.parse(t.text);console.log(i.reason)}})},this.doSignUp=function(e){e.preventDefault();var s=t.screenName.value.trim(),n=t.displayName.value.trim(),o=t.mail.value.trim(),a=t.signUpPassword.value.trim(),l=t.signUpPasswordConfirm.value.trim();t.signUp.screenName.isEmpty=""==s,t.signUp.displayName.isEmpty=""==n,t.signUp.mail.isEmpty=""==o,t.signUp.password.isEmpty=""==a,t.signUp.passwordConfirm.isEmpty=""==l,t.signUp.screenName.isEmpty||t.signUp.displayName.isEmpty||t.signUp.mail.isEmpty||t.signUp.password.isEmpty||t.signUp.passwordConfirm.isEmpty||i.post("api/auth/signup").send({screenName:s,displayName:n,mail:o,password:a,passwordConfirm:l}).set("Accept","application/json").end(function(e,t){t.ok&&location.reload()})}}),riot.tag("timeline",'<ul class="pg-timeline"><li class="pg-timeline-tweet" each="{tweets}"><img src="http://placehold.jp/64x64.png"><h3><a href="/member/{memberId}">screenName</a></h3><p data-tweet-id="{tweetId}">{text}</p><time><a href="/tweet/{tweetId}">{postedAt}</a></time></li></ul>',function(e){var t=this,i=window.superagent;this.tweets=[];var s=function(){var n="/api/timeline/"+e.target;t.tweets.length>0&&(n+="?after="+t.tweets[0].timestamp),i.get(n).withCredentials().end(function(e,i){if(i.ok){var s=JSON.parse(i.text);t.tweets=_.chain(s.value.tweets).map(function(e){return{memberId:e.memberId,tweetId:e.tweetId,text:e.text,postedAt:e.postedAt,timestamp:e.timestamp}}).concat(t.tweets).value(),t.update()}}),setTimeout(s,1e4)};s()}),riot.tag("tweet",'<section><header><img alt="memberIcon" src="/assets/icon/1"><dl><dt>{displayName}</dt><dd>@{screenName}</dd></dl><follow></follow></header><p if="{isRetweet}">{opts.tweet.reTweet.text}</p><p>{opts.tweet.text}</p><footer><time>{opts.tweet.postedAt}</time></footer></section>',function(e){this.isRetweet=null!=e.tweet.reTweet});